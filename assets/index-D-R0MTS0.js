(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();const z=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),K=(e,{onPreviewPicture:t,onLikeIcon:n,onDeleteCard:r,onInfoClick:o},c,i)=>{const l=z(),b=l.querySelector(".card__like-button"),T=l.querySelector(".card__control-button_type_delete"),C=l.querySelector(".card__image"),J=l.querySelector(".card__title"),w=l.querySelector(".card__like-count");C.src=e.link,C.alt=e.name,J.textContent=e.name,w&&(w.textContent=e.likesCount||0),e.isLiked&&b.classList.add("card__like-button_is-active"),e.owner&&e.owner._id!==c&&(T.style.display="none"),n&&b.addEventListener("click",()=>n(b,i)),r&&e.owner&&e.owner._id===c&&T.addEventListener("click",()=>r(l,i)),t&&C.addEventListener("click",()=>t({name:e.name,link:e.link}));const R=l.querySelector(".card__control-button_type_info");return o&&R.addEventListener("click",()=>o(i)),l},U=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},_=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",U)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",U)},G=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",n=>{n.target.classList.contains("popup")&&a(e)})},Q=(e,t,n,r)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)},N=(e,t,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(n.inputErrorClass),r.textContent="",r.classList.remove(n.errorClass)},X=(e,t,n)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?N(e,t,n):Q(e,t,t.validationMessage,n)},Y=e=>Array.from(e).some(t=>!t.validity.valid),D=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},Z=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},P=(e,t,n)=>{Y(e)?D(t,n):Z(t,n)},ee=(e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);P(n,r,t),n.forEach(o=>{o.addEventListener("input",()=>{X(e,o,t),P(n,r,t)})})},f=(e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach(o=>{N(e,o,t)}),D(r,t)},te=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(n=>{ee(n,e)})},s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"435a7b59-8fdf-4fcc-b21d-53bc775e9c19","Content-Type":"application/json"}},p=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),oe=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(p),O=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(p),ne=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(p),re=e=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(p),ce=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(p),se=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(p),le=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(p),m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};te(m);const W=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),v=L.querySelector(".popup__form"),H=v.querySelector(".popup__input_type_name"),V=v.querySelector(".popup__input_type_description"),g=document.querySelector(".popup_type_new-card"),u=g.querySelector(".popup__form"),ie=u.querySelector(".popup__input_type_card-name"),ae=u.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_image"),A=E.querySelector(".popup__image"),ue=E.querySelector(".popup__caption"),pe=document.querySelector(".profile__edit-button"),de=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_edit-avatar"),d=B.querySelector(".popup__form"),_e=d.querySelector(".popup__input"),y=document.querySelector(".popup_type_info"),me=y.querySelector(".popup__title"),$=y.querySelector(".popup__info"),fe=y.querySelector(".popup__text"),F=y.querySelector(".popup__list"),M=document.querySelector(".popup_type_remove-card"),ye=M.querySelector(".popup__form");let q="";const j=(e,t)=>{const n=e.likes.some(o=>o._id===t),r=K({...e,isLiked:n,likesCount:e.likes.length},{onPreviewPicture:he,onLikeIcon:(o,c)=>Se(o,c),onDeleteCard:(o,c)=>ve(o,c),onInfoClick:ke},t,e._id);if(e.owner._id===t){const o=r.querySelector(".card__control-button_type_delete");o.style.display="block"}return r},he=({name:e,link:t})=>{A.src=t,A.alt=e,ue.textContent=e,_(E)},Se=(e,t,n)=>{const r=e.classList.contains("card__like-button_is-active"),o=e.closest(".card__likes").querySelector(".card__like-count");le(t,r).then(c=>{e.classList.toggle("card__like-button_is-active"),o.textContent=c.likes.length}).catch(c=>{console.log(c)})};let h=null,S=null;const ve=(e,t)=>{S=e,h=t,_(M)},be=e=>{e.preventDefault(),h&&S&&se(h).then(()=>{S.remove(),a(M),h=null,S=null}).catch(t=>{console.log(t)})},Ce=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),n=t.textContent;t.textContent="Сохранение...",ne({name:H.value,about:V.value}).then(r=>{k.textContent=r.name,x.textContent=r.about,a(L)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=n})},qe=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),n=t.textContent;t.textContent="Сохранение...",re(_e.value).then(r=>{I.style.backgroundImage=`url(${r.avatar})`,d.reset(),a(B),f(d,m)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=n})},Le=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),n=t.textContent;t.textContent="Создание...",ce({name:ie.value,link:ae.value}).then(r=>{const o=j(r,q);W.prepend(o),u.reset(),a(g),f(u,m)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=n})};v.addEventListener("submit",Ce);u.addEventListener("submit",Le);d.addEventListener("submit",qe);ye.addEventListener("submit",be);pe.addEventListener("click",()=>{H.value=k.textContent,V.value=x.textContent,f(v,m),_(L)});I.addEventListener("click",()=>{d.reset(),f(d,m),_(B)});de.addEventListener("click",()=>{u.reset(),f(u,m),_(g)});Promise.all([O(),oe()]).then(([e,t])=>{q=t._id,k.textContent=t.name,x.textContent=t.about,I.style.backgroundImage=`url(${t.avatar})`,e.forEach(n=>{const r=j(n,q);W.append(r)})}).catch(e=>{console.log(e)});const ge=document.querySelectorAll(".popup");ge.forEach(e=>{G(e)});const Ee=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),ke=e=>{O().then(t=>{const n=t.find(o=>o._id===e);if(!n)return;me.textContent="Информация о карточке",$.innerHTML="",F.innerHTML="";const r=(o,c)=>{const l=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return l.querySelector(".popup__info-term").textContent=o,l.querySelector(".popup__info-description").textContent=c,l};$.append(r("Описание:",n.name),r("Дата создания:",Ee(new Date(n.createdAt))),r("Владелец:",n.owner.name),r("Количество лайков:",n.likes.length)),fe.textContent="Лайкнули:",n.likes.forEach(o=>{const i=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);i.innerHTML=`
          <p class="popup__user-name">${o.name}</p>
        `,F.append(i)}),_(y)}).catch(t=>{console.log(t)})};
